{"ast":null,"code":"import _toConsumableArray from\"/home/yclnl/yclnl.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import React from\"react\";import{Card,Select}from\"antd\";import{NumericInput}from\"../numericInput\";import{getPoolName,getTokenName,isKnownMint}from\"../../utils/utils\";import{useUserAccounts,useMint,useCachedPool}from\"../../utils/accounts\";import\"./styles.less\";import{useConnectionConfig}from\"../../utils/connection\";import{PoolIcon,TokenIcon}from\"../tokenIcon\";import PopularTokens from\"../../utils/token-list.json\";var Option=Select.Option;export var CurrencyInput=function CurrencyInput(props){var _useUserAccounts=useUserAccounts(),userAccounts=_useUserAccounts.userAccounts;var _useCachedPool=useCachedPool(),pools=_useCachedPool.pools;var mint=useMint(props.mint);var _useConnectionConfig=useConnectionConfig(),env=_useConnectionConfig.env;var tokens=PopularTokens[env];var renderPopularTokens=tokens.map(function(item){return/*#__PURE__*/React.createElement(Option,{key:item.mintAddress,value:item.mintAddress,name:item.tokenSymbol,title:item.mintAddress},/*#__PURE__*/React.createElement(\"div\",{key:item.mintAddress,style:{display:\"flex\",alignItems:\"center\"}},/*#__PURE__*/React.createElement(TokenIcon,{mintAddress:item.mintAddress}),item.tokenSymbol));});// TODO: expand nested pool names ...?\n// group accounts by mint and use one with biggest balance\nvar grouppedUserAccounts=userAccounts.sort(function(a,b){return b.info.amount.toNumber()-a.info.amount.toNumber();}).reduce(function(map,acc){var mint=acc.info.mint.toBase58();if(isKnownMint(env,mint)){return map;}var pool=pools.find(function(p){return p&&p.pubkeys.mint.toBase58()===mint;});map.set(mint,(map.get(mint)||[]).concat([{account:acc,pool:pool}]));return map;},new Map());var additionalAccounts=_toConsumableArray(grouppedUserAccounts.keys());if(tokens.findIndex(function(t){return t.mintAddress===props.mint;})<0&&props.mint&&!grouppedUserAccounts.has(props===null||props===void 0?void 0:props.mint)){additionalAccounts.push(props.mint);}var renderAdditionalTokens=additionalAccounts.map(function(mint){var pool;var list=grouppedUserAccounts.get(mint);if(list&&list.length>0){// TODO: group multple accounts of same time and select one with max amount\nvar _account=list[0];pool=_account.pool;}var name;var icon;if(pool){name=getPoolName(env,pool);var sorted=pool.pubkeys.holdingMints.map(function(a){return a.toBase58();}).sort();icon=/*#__PURE__*/React.createElement(PoolIcon,{mintA:sorted[0],mintB:sorted[1]});}else{name=getTokenName(env,mint);icon=/*#__PURE__*/React.createElement(TokenIcon,{mintAddress:mint});}return/*#__PURE__*/React.createElement(Option,{key:mint,value:mint,name:name,title:mint},/*#__PURE__*/React.createElement(\"div\",{key:mint,style:{display:\"flex\",alignItems:\"center\"}},icon,name));});var userUiBalance=function userUiBalance(){var currentAccount=userAccounts===null||userAccounts===void 0?void 0:userAccounts.find(function(a){return a.info.mint.toBase58()===props.mint;});if(currentAccount&&mint){return currentAccount.info.amount.toNumber()/Math.pow(10,mint.decimals);}return 0;};return/*#__PURE__*/React.createElement(Card,{className:\"ccy-input\",style:{borderRadius:20},bodyStyle:{padding:0}},/*#__PURE__*/React.createElement(\"div\",{className:\"ccy-input-header\"},/*#__PURE__*/React.createElement(\"div\",{className:\"ccy-input-header-left\"},props.title),/*#__PURE__*/React.createElement(\"div\",{className:\"ccy-input-header-right\",onClick:function onClick(e){return props.onInputChange&&props.onInputChange(userUiBalance());}},\"Balance: \",userUiBalance().toFixed(6))),/*#__PURE__*/React.createElement(\"div\",{className:\"ccy-input-header\",style:{padding:\"0px 10px 5px 7px\"}},/*#__PURE__*/React.createElement(NumericInput,{value:props.amount,onChange:function onChange(val){if(props.onInputChange){props.onInputChange(val);}},style:{fontSize:20,boxShadow:\"none\",borderColor:\"transparent\",outline:\"transpaernt\"},placeholder:\"0.00\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"ccy-input-header-right\",style:{display:\"felx\"}},/*#__PURE__*/React.createElement(Select,{size:\"large\",showSearch:true,style:{minWidth:120},placeholder:\"CCY\",value:props.mint,onChange:function onChange(item){if(props.onMintChange){props.onMintChange(item);}},filterOption:function filterOption(input,option){var _option$name;return(option===null||option===void 0?void 0:(_option$name=option.name)===null||_option$name===void 0?void 0:_option$name.toLowerCase().indexOf(input.toLowerCase()))>=0;}},[].concat(_toConsumableArray(renderPopularTokens),_toConsumableArray(renderAdditionalTokens))))));};","map":{"version":3,"sources":["/home/yclnl/yclnl.github.io/src/components/currencyInput/index.tsx"],"names":["React","Card","Select","NumericInput","getPoolName","getTokenName","isKnownMint","useUserAccounts","useMint","useCachedPool","useConnectionConfig","PoolIcon","TokenIcon","PopularTokens","Option","CurrencyInput","props","userAccounts","pools","mint","env","tokens","renderPopularTokens","map","item","mintAddress","tokenSymbol","display","alignItems","grouppedUserAccounts","sort","a","b","info","amount","toNumber","reduce","acc","toBase58","pool","find","p","pubkeys","set","get","concat","account","Map","additionalAccounts","keys","findIndex","t","has","push","renderAdditionalTokens","list","length","name","icon","sorted","holdingMints","userUiBalance","currentAccount","Math","pow","decimals","borderRadius","padding","title","e","onInputChange","toFixed","val","fontSize","boxShadow","borderColor","outline","minWidth","onMintChange","input","option","toLowerCase","indexOf"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { Card, Select } from \"antd\";\nimport { NumericInput } from \"../numericInput\";\nimport {\n  getPoolName,\n  getTokenName,\n  isKnownMint,\n  KnownToken,\n} from \"../../utils/utils\";\nimport { useUserAccounts, useMint, useCachedPool } from \"../../utils/accounts\";\nimport \"./styles.less\";\nimport { useConnectionConfig } from \"../../utils/connection\";\nimport { PoolIcon, TokenIcon } from \"../tokenIcon\";\nimport PopularTokens from \"../../utils/token-list.json\";\nimport { PublicKey } from \"@solana/web3.js\";\nimport { PoolInfo, TokenAccount } from \"../../models\";\n\nconst { Option } = Select;\n\nexport const CurrencyInput = (props: {\n  mint?: string;\n  amount?: string;\n  title?: string;\n  onInputChange?: (val: number) => void;\n  onMintChange?: (account: string) => void;\n}) => {\n  const { userAccounts } = useUserAccounts();\n  const { pools } = useCachedPool();\n  const mint = useMint(props.mint);\n\n  const { env } = useConnectionConfig();\n\n  const tokens = PopularTokens[env] as KnownToken[];\n\n  const renderPopularTokens = tokens.map((item) => {\n    return (\n      <Option\n        key={item.mintAddress}\n        value={item.mintAddress}\n        name={item.tokenSymbol}\n        title={item.mintAddress}\n      >\n        <div\n          key={item.mintAddress}\n          style={{ display: \"flex\", alignItems: \"center\" }}\n        >\n          <TokenIcon mintAddress={item.mintAddress} />\n          {item.tokenSymbol}\n        </div>\n      </Option>\n    );\n  });\n\n  // TODO: expand nested pool names ...?\n\n  // group accounts by mint and use one with biggest balance\n  const grouppedUserAccounts = userAccounts\n    .sort((a, b) => {\n      return b.info.amount.toNumber() - a.info.amount.toNumber();\n    })\n    .reduce((map, acc) => {\n      const mint = acc.info.mint.toBase58();\n      if (isKnownMint(env, mint)) {\n        return map;\n      }\n\n      const pool = pools.find((p) => p && p.pubkeys.mint.toBase58() === mint);\n\n      map.set(mint, (map.get(mint) || []).concat([{ account: acc, pool }]));\n\n      return map;\n    }, new Map<string, { account: TokenAccount; pool: PoolInfo | undefined }[]>());\n\n  const additionalAccounts = [...grouppedUserAccounts.keys()];\n  if (tokens.findIndex((t) => t.mintAddress === props.mint) < 0 && props.mint && !grouppedUserAccounts.has(props?.mint)) {\n    additionalAccounts.push(props.mint);\n  }\n\n  const renderAdditionalTokens = additionalAccounts.map(\n    (mint) => {\n      let pool: PoolInfo | undefined;\n      const list = grouppedUserAccounts.get(mint);\n      if (list && list.length > 0) {\n        // TODO: group multple accounts of same time and select one with max amount\n        const account = list[0];\n        pool = account.pool;\n      }\n\n      let name: string;\n      let icon: JSX.Element;\n      if (pool) {\n        name = getPoolName(env, pool);\n\n        const sorted = pool.pubkeys.holdingMints\n          .map((a: PublicKey) => a.toBase58())\n          .sort();\n        icon = <PoolIcon mintA={sorted[0]} mintB={sorted[1]} />;\n      } else {\n        name = getTokenName(env, mint);\n        icon = <TokenIcon mintAddress={mint} />;\n      }\n\n      return (\n        <Option\n          key={mint}\n          value={mint}\n          name={name}\n          title={mint}\n        >\n          <div key={mint} style={{ display: \"flex\", alignItems: \"center\" }}>\n            {icon}\n            {name}\n          </div>\n        </Option>\n      );\n    }\n  );\n\n  const userUiBalance = () => {\n    const currentAccount = userAccounts?.find(\n      (a) => a.info.mint.toBase58() === props.mint\n    );\n    if (currentAccount && mint) {\n      return (\n        currentAccount.info.amount.toNumber() / Math.pow(10, mint.decimals)\n      );\n    }\n\n    return 0;\n  };\n\n  return (\n    <Card\n      className=\"ccy-input\"\n      style={{ borderRadius: 20 }}\n      bodyStyle={{ padding: 0 }}\n    >\n      <div className=\"ccy-input-header\">\n        <div className=\"ccy-input-header-left\">{props.title}</div>\n\n        <div\n          className=\"ccy-input-header-right\"\n          onClick={(e) =>\n            props.onInputChange && props.onInputChange(userUiBalance())\n          }\n        >\n          Balance: {userUiBalance().toFixed(6)}\n        </div>\n      </div>\n      <div className=\"ccy-input-header\" style={{ padding: \"0px 10px 5px 7px\" }}>\n        <NumericInput\n          value={props.amount}\n          onChange={(val: any) => {\n            if (props.onInputChange) {\n              props.onInputChange(val);\n            }\n          }}\n          style={{\n            fontSize: 20,\n            boxShadow: \"none\",\n            borderColor: \"transparent\",\n            outline: \"transpaernt\",\n          }}\n          placeholder=\"0.00\"\n        />\n\n        <div className=\"ccy-input-header-right\" style={{ display: \"felx\" }}>\n          <Select\n            size=\"large\"\n            showSearch\n            style={{ minWidth: 120 }}\n            placeholder=\"CCY\"\n            value={props.mint}\n            onChange={(item) => {\n              if (props.onMintChange) {\n                props.onMintChange(item);\n              }\n            }}\n            filterOption={(input, option) =>\n              option?.name?.toLowerCase().indexOf(input.toLowerCase()) >= 0\n            }\n          >\n            {[...renderPopularTokens, ...renderAdditionalTokens]}\n          </Select>\n        </div>\n      </div>\n    </Card>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}