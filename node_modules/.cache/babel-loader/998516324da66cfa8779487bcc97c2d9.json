{"ast":null,"code":"import _slicedToArray from\"/home/yclnl/yclnl.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useCallback,useEffect,useRef,useState}from\"react\";import{Button,Popover,Table}from\"antd\";import{AppBar}from\"./../appBar\";import{Settings}from\"../settings\";import{SettingOutlined}from\"@ant-design/icons\";import{PoolIcon}from\"../tokenIcon\";import{Input}from\"antd\";import\"./styles.less\";import echarts from\"echarts\";import{useEnrichedPools}from\"../../context/market\";import{usePools}from\"../../utils/pools\";import{formatPct,formatUSD}from\"../../utils/utils\";import{PoolAddress}from\"../pool/address\";var Search=Input.Search;var FlashText=function FlashText(props){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),activeClass=_useState2[0],setActiveClass=_useState2[1];var _useState3=useState(props.val),_useState4=_slicedToArray(_useState3,1),value=_useState4[0];useEffect(function(){if(props.val!==value){setActiveClass(props.val>value?\"flash-positive\":\"flash-negative\");setTimeout(function(){return setActiveClass(\"\");},200);}},[props.text,props.val,value]);return/*#__PURE__*/React.createElement(\"span\",{className:activeClass},props.text);};export var ChartsView=React.memo(function(){var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),search=_useState6[0],setSearch=_useState6[1];var _useState7=useState(function(){return{liquidity:0,volume:0,fees:0};}),_useState8=_slicedToArray(_useState7,2),totals=_useState8[0],setTotals=_useState8[1];var chartDiv=useRef(null);var echartsRef=useRef(null);var _usePools=usePools(),pools=_usePools.pools;var enriched=useEnrichedPools(pools);// separate connection for market updates\nuseEffect(function(){if(chartDiv.current){echartsRef.current=echarts.init(chartDiv.current);}return function(){echartsRef.current.dispose();};},[]);// TODO: display user percent in the pool\n// const { ownedPools } = useOwnedPools();\n// TODO: create cache object with layout type, get, query, add\nvar searchRegex;try{searchRegex=new RegExp(search,\"i\");}catch(_unused){// ignore bad regex typed by user\n}var updateChart=useCallback(function(){if(echartsRef.current){echartsRef.current.setOption({series:[{name:\"Liquidity\",type:\"treemap\",top:0,bottom:10,left:30,right:30,animation:false,// visibleMin: 300,\nlabel:{show:true,formatter:\"{b}\"},itemStyle:{normal:{borderColor:\"#000\"}},breadcrumb:{show:false},data:enriched.filter(function(row){return!search||!searchRegex||searchRegex.test(row.name);}).map(function(row){return{value:row.liquidity,name:row.name,path:\"Liquidity/\".concat(row.name),data:row};})}]});}},[enriched,echartsRef.current,search]);// Updates total values\nuseEffect(function(){setTotals(enriched.reduce(function(acc,item){acc.liquidity=acc.liquidity+item.liquidity;acc.volume=acc.volume+item.volume;acc.fees=acc.fees+item.fees;return acc;},{liquidity:0,volume:0,fees:0}));updateChart();},[enriched,updateChart,search]);var columns=[{title:\"Name\",dataIndex:\"name\",key:\"name\",render:function render(text,record){return{props:{style:{}},children:/*#__PURE__*/React.createElement(\"div\",{style:{display:\"flex\"}},/*#__PURE__*/React.createElement(PoolIcon,{mintA:record.mints[0],mintB:record.mints[1]}),/*#__PURE__*/React.createElement(\"a\",{href:record.link,target:\"_blank\",rel:\"noopener noreferrer\"},text))};}},{title:\"Liquidity\",dataIndex:\"liquidity\",key:\"liquidity\",render:function render(text,record){return{props:{style:{textAlign:\"right\"}},children:/*#__PURE__*/React.createElement(FlashText,{text:formatUSD.format(record.liquidity),val:record.liquidity})};},sorter:function sorter(a,b){return a.liquidity-b.liquidity;},defaultSortOrder:\"descend\"},{title:\"Supply\",dataIndex:\"supply\",key:\"supply\",render:function render(text,record){return{props:{style:{textAlign:\"right\"}},children:/*#__PURE__*/React.createElement(FlashText,{text:text,val:record.supply})};},sorter:function sorter(a,b){return a.supply-b.supply;}},{title:\"Volume\",dataIndex:\"volume\",key:\"volume\",render:function render(text,record){return{props:{style:{textAlign:\"right\"}},children:/*#__PURE__*/React.createElement(FlashText,{text:formatUSD.format(record.volume),val:record.volume})};},sorter:function sorter(a,b){return a.volume-b.volume;}},{title:\"Fees\",dataIndex:\"fees\",key:\"fees\",render:function render(text,record){return{props:{style:{textAlign:\"right\"}},children:/*#__PURE__*/React.createElement(FlashText,{text:formatUSD.format(record.fees),val:record.fees})};}},{title:\"APY\",dataIndex:\"apy\",key:\"apy\",render:function render(text,record){return{props:{style:{textAlign:\"right\"}},children:formatPct.format(record.apy)};},sorter:function sorter(a,b){return a.apy-b.apy;}},{title:\"Address\",dataIndex:\"address\",key:\"address\",render:function render(text,record){return{props:{style:{fontFamily:\"monospace\"}},children:/*#__PURE__*/React.createElement(PoolAddress,{pool:record.raw})};}}];return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(AppBar,{right:/*#__PURE__*/React.createElement(Popover,{placement:\"topRight\",title:\"Settings\",content:/*#__PURE__*/React.createElement(Settings,null),trigger:\"click\"},/*#__PURE__*/React.createElement(Button,{shape:\"circle\",size:\"large\",type:\"text\",icon:/*#__PURE__*/React.createElement(SettingOutlined,null)}))}),/*#__PURE__*/React.createElement(\"div\",{className:\"info-header\"},/*#__PURE__*/React.createElement(\"h1\",null,\"Liquidity: \",formatUSD.format(totals.liquidity)),/*#__PURE__*/React.createElement(\"h1\",null,\"Volume: \",formatUSD.format(totals.volume)),/*#__PURE__*/React.createElement(Search,{className:\"search-input\",placeholder:\"Filter\",type:\"search\",value:search,onChange:function onChange(e){return setSearch(e.target.value);},onSearch:function onSearch(value){return setSearch(value);},style:{width:200}})),/*#__PURE__*/React.createElement(\"div\",{ref:chartDiv,style:{height:\"250px\",width:\"100%\"}}),/*#__PURE__*/React.createElement(Table,{dataSource:enriched.filter(function(row){return!search||!searchRegex||searchRegex.test(row.name);}),columns:columns,size:\"small\",pagination:{pageSize:10}}));});","map":{"version":3,"sources":["/home/yclnl/yclnl.github.io/src/components/charts/index.tsx"],"names":["React","useCallback","useEffect","useRef","useState","Button","Popover","Table","AppBar","Settings","SettingOutlined","PoolIcon","Input","echarts","useEnrichedPools","usePools","formatPct","formatUSD","PoolAddress","Search","FlashText","props","activeClass","setActiveClass","val","value","setTimeout","text","ChartsView","memo","search","setSearch","liquidity","volume","fees","totals","setTotals","chartDiv","echartsRef","pools","enriched","current","init","dispose","searchRegex","RegExp","updateChart","setOption","series","name","type","top","bottom","left","right","animation","label","show","formatter","itemStyle","normal","borderColor","breadcrumb","data","filter","row","test","map","path","reduce","acc","item","columns","title","dataIndex","key","render","record","style","children","display","mints","link","textAlign","format","sorter","a","b","defaultSortOrder","supply","apy","fontFamily","raw","e","target","width","height","pageSize"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport { Button, Popover, Table } from \"antd\";\nimport { AppBar } from \"./../appBar\";\nimport { Settings } from \"../settings\";\nimport { SettingOutlined } from \"@ant-design/icons\";\nimport { PoolIcon } from \"../tokenIcon\";\nimport { Input } from \"antd\";\nimport \"./styles.less\";\nimport echarts from \"echarts\";\nimport { useEnrichedPools } from \"../../context/market\";\nimport { usePools } from \"../../utils/pools\";\nimport { formatPct, formatUSD } from \"../../utils/utils\";\nimport { PoolAddress } from \"../pool/address\";\n\nconst { Search } = Input;\n\nconst FlashText = (props: { text: string; val: number }) => {\n  const [activeClass, setActiveClass] = useState(\"\");\n  const [value] = useState(props.val);\n  useEffect(() => {\n    if (props.val !== value) {\n      setActiveClass(props.val > value ? \"flash-positive\" : \"flash-negative\");\n\n      setTimeout(() => setActiveClass(\"\"), 200);\n    }\n  }, [props.text, props.val, value]);\n\n  return <span className={activeClass}>{props.text}</span>;\n};\n\ninterface Totals {\n  liquidity: number;\n  volume: number;\n  fees: number;\n}\n\nexport const ChartsView = React.memo(() => {\n  const [search, setSearch] = useState<string>(\"\");\n  const [totals, setTotals] = useState<Totals>(() => ({\n    liquidity: 0,\n    volume: 0,\n    fees: 0,\n  }));\n  const chartDiv = useRef<HTMLDivElement>(null);\n  const echartsRef = useRef<any>(null);\n  const { pools } = usePools();\n  const enriched = useEnrichedPools(pools);\n  // separate connection for market updates\n\n  useEffect(() => {\n    if (chartDiv.current) {\n      echartsRef.current = echarts.init(chartDiv.current);\n    }\n\n    return () => {\n      echartsRef.current.dispose();\n    };\n  }, []);\n\n  // TODO: display user percent in the pool\n  // const { ownedPools } = useOwnedPools();\n\n  // TODO: create cache object with layout type, get, query, add\n\n  let searchRegex: RegExp;\n  try {\n    searchRegex = new RegExp(search, \"i\");\n  } catch {\n    // ignore bad regex typed by user\n  }\n\n  const updateChart = useCallback(() => {\n    if (echartsRef.current) {\n      echartsRef.current.setOption({\n        series: [\n          {\n            name: \"Liquidity\",\n            type: \"treemap\",\n            top: 0,\n            bottom: 10,\n            left: 30,\n            right: 30,\n            animation: false,\n            // visibleMin: 300,\n            label: {\n              show: true,\n              formatter: \"{b}\",\n            },\n            itemStyle: {\n              normal: {\n                borderColor: \"#000\",\n              },\n            },\n            breadcrumb: {\n              show: false,\n            },\n            data: enriched\n              .filter(\n                (row) => !search || !searchRegex || searchRegex.test(row.name)\n              )\n              .map((row) => {\n                return {\n                  value: row.liquidity,\n                  name: row.name,\n                  path: `Liquidity/${row.name}`,\n                  data: row,\n                };\n              }),\n          },\n        ],\n      });\n    }\n  }, [enriched, echartsRef.current, search]);\n\n  // Updates total values\n  useEffect(() => {\n    setTotals(\n      enriched.reduce(\n        (acc, item) => {\n          acc.liquidity = acc.liquidity + item.liquidity;\n          acc.volume = acc.volume + item.volume;\n          acc.fees = acc.fees + item.fees;\n          return acc;\n        },\n        { liquidity: 0, volume: 0, fees: 0 } as Totals\n      )\n    );\n\n    updateChart();\n  }, [enriched, updateChart, search]);\n\n  const columns = [\n    {\n      title: \"Name\",\n      dataIndex: \"name\",\n      key: \"name\",\n      render(text: string, record: any) {\n        return {\n          props: {\n            style: {},\n          },\n          children: (\n            <div style={{ display: \"flex\" }}>\n              <PoolIcon mintA={record.mints[0]} mintB={record.mints[1]} />\n              <a href={record.link} target=\"_blank\" rel=\"noopener noreferrer\">\n                {text}\n              </a>\n            </div>\n          ),\n        };\n      },\n    },\n    {\n      title: \"Liquidity\",\n      dataIndex: \"liquidity\",\n      key: \"liquidity\",\n      render(text: string, record: any) {\n        return {\n          props: {\n            style: { textAlign: \"right\" },\n          },\n          children: (\n            <FlashText\n              text={formatUSD.format(record.liquidity)}\n              val={record.liquidity}\n            />\n          ),\n        };\n      },\n      sorter: (a: any, b: any) => a.liquidity - b.liquidity,\n      defaultSortOrder: \"descend\" as any,\n    },\n    {\n      title: \"Supply\",\n      dataIndex: \"supply\",\n      key: \"supply\",\n      render(text: string, record: any) {\n        return {\n          props: {\n            style: { textAlign: \"right\" },\n          },\n          children: <FlashText text={text} val={record.supply} />,\n        };\n      },\n      sorter: (a: any, b: any) => a.supply - b.supply,\n    },\n    {\n      title: \"Volume\",\n      dataIndex: \"volume\",\n      key: \"volume\",\n      render(text: string, record: any) {\n        return {\n          props: {\n            style: { textAlign: \"right\" },\n          },\n          children: (\n            <FlashText\n              text={formatUSD.format(record.volume)}\n              val={record.volume}\n            />\n          ),\n        };\n      },\n      sorter: (a: any, b: any) => a.volume - b.volume,\n    },\n    {\n      title: \"Fees\",\n      dataIndex: \"fees\",\n      key: \"fees\",\n      render(text: string, record: any) {\n        return {\n          props: {\n            style: { textAlign: \"right\" },\n          },\n          children: (\n            <FlashText text={formatUSD.format(record.fees)} val={record.fees} />\n          ),\n        };\n      },\n    },\n    {\n      title: \"APY\",\n      dataIndex: \"apy\",\n      key: \"apy\",\n      render(text: string, record: any) {\n        return {\n          props: {\n            style: { textAlign: \"right\" },\n          },\n          children: formatPct.format(record.apy),\n        };\n      },\n      sorter: (a: any, b: any) => a.apy - b.apy,\n    },\n    {\n      title: \"Address\",\n      dataIndex: \"address\",\n      key: \"address\",\n      render(text: string, record: any) {\n        return {\n          props: {\n            style: { fontFamily: \"monospace\" } as React.CSSProperties,\n          },\n          children: <PoolAddress pool={record.raw} />,\n        };\n      },\n    },\n  ];\n\n  return (\n    <>\n      <AppBar\n        right={\n          <Popover\n            placement=\"topRight\"\n            title=\"Settings\"\n            content={<Settings />}\n            trigger=\"click\"\n          >\n            <Button\n              shape=\"circle\"\n              size=\"large\"\n              type=\"text\"\n              icon={<SettingOutlined />}\n            />\n          </Popover>\n        }\n      />\n      <div className=\"info-header\">\n        <h1>Liquidity: {formatUSD.format(totals.liquidity)}</h1>\n        <h1>Volume: {formatUSD.format(totals.volume)}</h1>\n        <Search\n          className=\"search-input\"\n          placeholder=\"Filter\"\n          type=\"search\"\n          value={search}\n          onChange={(e) => setSearch(e.target.value)}\n          onSearch={(value) => setSearch(value)}\n          style={{ width: 200 }}\n        />\n      </div>\n      <div ref={chartDiv} style={{ height: \"250px\", width: \"100%\" }} />\n      <Table\n        dataSource={enriched.filter(\n          (row) => !search || !searchRegex || searchRegex.test(row.name)\n        )}\n        columns={columns}\n        size=\"small\"\n        pagination={{ pageSize: 10 }}\n      />\n    </>\n  );\n});\n"]},"metadata":{},"sourceType":"module"}